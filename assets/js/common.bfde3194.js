(()=>{"use strict";var t={644:t=>{var e=Array.prototype,i=Object.prototype,s={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","\\":"&#92;"},n=/[&"'<>\\]/g,r=t.exports={};function a(t,e){return i.hasOwnProperty.call(t,e)}function o(t){return s[t]}function h(t,e,i){var s,n,r;if(t instanceof Error&&(t=(n=t).name+": "+n.message),Object.setPrototypeOf?(s=new Error(t),Object.setPrototypeOf(s,h.prototype)):(s=this,Object.defineProperty(s,"message",{enumerable:!1,writable:!0,value:t})),Object.defineProperty(s,"name",{value:"Template render error"}),Error.captureStackTrace&&Error.captureStackTrace(s,this.constructor),n){var a=Object.getOwnPropertyDescriptor(n,"stack");(r=a&&(a.get||function(){return a.value}))||(r=function(){return n.stack})}else{var o=new Error(t).stack;r=function(){return o}}return Object.defineProperty(s,"stack",{get:function(){return r.call(s)}}),Object.defineProperty(s,"cause",{value:n}),s.lineno=e,s.colno=i,s.firstUpdate=!0,s.Update=function(t){var e="("+(t||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?e+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(e+=" [Line "+this.lineno+"]")),e+="\n ",this.firstUpdate&&(e+=" "),this.message=e+(this.message||""),this.firstUpdate=!1,this},s}function l(t){return"[object Function]"===i.toString.call(t)}function c(t){return"[object Array]"===i.toString.call(t)}function u(t){return"[object String]"===i.toString.call(t)}function d(t){return"[object Object]"===i.toString.call(t)}function g(t){var e,i=(e=t)?"string"==typeof e?e.split("."):[e]:[];return function(t){for(var e=t,s=0;s<i.length;s++){var n=i[s];if(!a(e,n))return;e=e[n]}return e}}function p(t){return Array.prototype.slice.call(t)}function m(t,e,i){return Array.prototype.indexOf.call(t||[],e,i)}function w(t){var e=[];for(var i in t)a(t,i)&&e.push(i);return e}r.hasOwnProp=a,r._prettifyError=function(t,e,i){if(i.Update||(i=new r.TemplateError(i)),i.Update(t),!e){var s=i;(i=new Error(s.message)).name=s.name}return i},Object.setPrototypeOf?Object.setPrototypeOf(h.prototype,Error.prototype):h.prototype=Object.create(Error.prototype,{constructor:{value:h}}),r.TemplateError=h,r.escape=function(t){return t.replace(n,o)},r.isFunction=l,r.isArray=c,r.isString=u,r.isObject=d,r.getAttrGetter=g,r.groupBy=function(t,e,i){for(var s={},n=l(e)?e:g(e),r=0;r<t.length;r++){var a=t[r],o=n(a,r);if(void 0===o&&!0===i)throw new TypeError('groupby: attribute "'+e+'" resolved to undefined');(s[o]||(s[o]=[])).push(a)}return s},r.toArray=p,r.without=function(t){var e=[];if(!t)return e;for(var i=t.length,s=p(arguments).slice(1),n=-1;++n<i;)-1===m(s,t[n])&&e.push(t[n]);return e},r.repeat=function(t,e){for(var i="",s=0;s<e;s++)i+=t;return i},r.each=function(t,i,s){if(null!=t)if(e.forEach&&t.forEach===e.forEach)t.forEach(i,s);else if(t.length===+t.length)for(var n=0,r=t.length;n<r;n++)i.call(s,t[n],n,t)},r.map=function(t,i){var s=[];if(null==t)return s;if(e.map&&t.map===e.map)return t.map(i);for(var n=0;n<t.length;n++)s[s.length]=i(t[n],n);return t.length===+t.length&&(s.length=t.length),s},r.asyncIter=function(t,e,i){var s=-1;!function n(){++s<t.length?e(t[s],s,n,i):i()}()},r.asyncFor=function(t,e,i){var s=w(t||{}),n=s.length,r=-1;!function a(){r++;var o=s[r];r<n?e(o,t[o],r,n,a):i()}()},r.indexOf=m,r.keys=w,r._entries=function(t){return w(t).map((function(e){return[e,t[e]]}))},r._values=function(t){return w(t).map((function(e){return t[e]}))},r._assign=r.extend=function(t,e){return t=t||{},w(e).forEach((function(i){t[i]=e[i]})),t},r.inOperator=function(t,e){if(c(e)||u(e))return-1!==e.indexOf(t);if(d(e))return t in e;throw new Error('Cannot use "in" operator to search for "'+t+'" in unexpected types.')}},467:(t,e,i)=>{var s=i(644),n=Array.from,r="function"==typeof Symbol&&Symbol.iterator&&"function"==typeof n,a=function(){function t(t,e){this.variables=Object.create(null),this.parent=t,this.topLevel=!1,this.isolateWrites=e}var e=t.prototype;return e.set=function(t,e,i){var s=t.split("."),n=this.variables,r=this;if(i&&(r=this.resolve(s[0],!0)))r.set(t,e);else{for(var a=0;a<s.length-1;a++){var o=s[a];n[o]||(n[o]={}),n=n[o]}n[s[s.length-1]]=e}},e.get=function(t){var e=this.variables[t];return void 0!==e?e:null},e.lookup=function(t){var e=this.parent,i=this.variables[t];return void 0!==i?i:e&&e.lookup(t)},e.resolve=function(t,e){var i=e&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[t]?this:i&&i.resolve(t)},e.push=function(e){return new t(this,e)},e.pop=function(){return this.parent},t}();function o(t){return t&&Object.prototype.hasOwnProperty.call(t,"__keywords")}function h(t){var e=t.length;return 0===e?0:o(t[e-1])?e-1:e}function l(t){if("string"!=typeof t)return t;this.val=t,this.length=t.length}l.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}}),l.prototype.valueOf=function(){return this.val},l.prototype.toString=function(){return this.val},t.exports={Frame:a,makeMacro:function(t,e,i){return function(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];var a,l=h(n),c=function(t){var e=t.length;if(e){var i=t[e-1];if(o(i))return i}return{}}(n);if(l>t.length)a=n.slice(0,t.length),n.slice(a.length,l).forEach((function(t,i){i<e.length&&(c[e[i]]=t)})),a.push(c);else if(l<t.length){a=n.slice(0,l);for(var u=l;u<t.length;u++){var d=t[u];a.push(c[d]),delete c[d]}a.push(c)}else a=n;return i.apply(this,a)}},makeKeywordArgs:function(t){return t.__keywords=!0,t},numArgs:h,suppressValue:function(t,e){return t=null!=t?t:"",!e||t instanceof l||(t=s.escape(t.toString())),t},ensureDefined:function(t,e,i){if(null==t)throw new s.TemplateError("attempted to output null or undefined value",e+1,i+1);return t},memberLookup:function(t,e){if(null!=t)return"function"==typeof t[e]?function(){for(var i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t[e].apply(t,s)}:t[e]},contextOrFrameLookup:function(t,e,i){var s=e.lookup(i);return void 0!==s?s:t.lookup(i)},callWrap:function(t,e,i,s){if(!t)throw new Error("Unable to call `"+e+"`, which is undefined or falsey");if("function"!=typeof t)throw new Error("Unable to call `"+e+"`, which is not a function");return t.apply(i,s)},handleError:function(t,e,i){return t.lineno?t:new s.TemplateError(t,e,i)},isArray:s.isArray,keys:s.keys,SafeString:l,copySafeness:function(t,e){return t instanceof l?new l(e):e.toString()},markSafe:function(t){var e=typeof t;return"string"===e?new l(t):"function"!==e?t:function(e){var i=t.apply(this,arguments);return"string"==typeof i?new l(i):i}},asyncEach:function(t,e,i,n){if(s.isArray(t)){var r=t.length;s.asyncIter(t,(function(t,s,n){switch(e){case 1:i(t,s,r,n);break;case 2:i(t[0],t[1],s,r,n);break;case 3:i(t[0],t[1],t[2],s,r,n);break;default:t.push(s,r,n),i.apply(this,t)}}),n)}else s.asyncFor(t,(function(t,e,s,n,r){i(t,e,s,n,r)}),n)},asyncAll:function(t,e,i,n){var r,a,o=0;function h(t,e){o++,a[t]=e,o===r&&n(null,a.join(""))}if(s.isArray(t))if(r=t.length,a=new Array(r),0===r)n(null,"");else for(var l=0;l<t.length;l++){var c=t[l];switch(e){case 1:i(c,l,r,h);break;case 2:i(c[0],c[1],l,r,h);break;case 3:i(c[0],c[1],c[2],l,r,h);break;default:c.push(l,r,h),i.apply(this,c)}}else{var u=s.keys(t||{});if(r=u.length,a=new Array(r),0===r)n(null,"");else for(var d=0;d<u.length;d++){var g=u[d];i(g,t[g],d,r,h)}}},inOperator:s.inOperator,fromIterator:function(t){return"object"!=typeof t||null===t||s.isArray(t)?t:r&&Symbol.iterator in t?n(t):t}}},38:(t,e,i)=>{i(467).SafeString;e.oq=function(t,e){return t===e},e.oq,e.oq,e.Qq=function(t,e){return t>e},e.Qq,e.xR=function(t,e){return t<e},e.xR}},e={};const i={setStatus(t){const e=this.getStatuses();if(!Array.prototype.includes.call(e,t))throw new Error(`Invalid status: ${t}`);if(this["#status"]!==t&&this.triggerEvent){const e={id:"status",status:t};this.triggerEvent(e,e,this)}return this["#status"]=t,this},getStatus(){return this["#status"]||this.getStatuses()[0]}};function s(t,e){let i=null;return(...s)=>{window.clearTimeout(i),i=window.setTimeout((()=>{t(...s)}),e)}}const n={registerListener(t,e){const i="object"==typeof t?t.id:t;return this["#eventListeners"]||={},this["#eventListeners"][i]||=[],this["#eventListeners"][i].push(e),this},triggerEvent(t,...e){const i="object"==typeof t?t.id:t;((this["#eventListeners"]||{})[i]||[]).forEach((i=>i.apply(t,e)))}};class r extends Map{synchroniseDimensions(){this.forEach((t=>t.synchroniseDimensions()))}render(){this.forEach((t=>t.render()))}last(){if(0!==this.size)return Array.from(this.entries())[this.size-1][1]}}class a{r;g;b;a;constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s}}function o(t,e,i){i||=t=>t;const s=Math.ceil(t),n=Math.floor(e);return Math.floor(i(Math.random())*(n-s+1)+s)}function h(t){return Number(t)===t}function l(t,e,i){return Math.min(Math.max(t,e),i)}function c(t){return t*t}const u=2*Math.PI;class d{distance;angle;constructor(t,e){this.distance=t,this.angle=e}applyToPoint(t,e){return e=h(e)?e:1,new f(t.x+Math.cos(this.angle.asRadians().value())*this.distance*e,t.y+Math.sin(this.angle.asRadians().value())*this.distance*e)}toString(){return"->("+this.distance.toFixed(3)+","+this.angle.toString()+")"}}class g{#t;#e;static createFromPoints(t,e){return new g(new d(t.distanceToPoint(e),t.angleToPoint(e)),t)}constructor(t,e){this.#e=t,this.#t=e}start(){return this.#t}end(t){return t=h(t)?t:1,this.#e.applyToPoint(this.#t,t)}angle(){return this.#e.angle}getInverted(){return new g(new d(this.#e.distance,this.#e.angle.flip()),this.end(1))}toString(){return this.start().toString()+this.#e.toString()}}class p{constructor(){if(this.constructor===p)throw new Error("Abstract classes can't be instantiated.")}asRadians(){throw new Error("Method 'asRadians()' must be implemented.")}asDegrees(){throw new Error("Method 'asDegrees()' must be implemented.")}value(){throw new Error("Method 'value()' must be implemented.")}flip(){throw new Error("Method 'flip()' must be implemented.")}equals(){throw new Error("Method 'equals()' must be implemented.")}lessThanOrEqualTo(t){throw new Error("Method 'lessThanOrEqualTo()' must be implemented.")}add(t){throw new Error("Method 'add()' must be implemented.")}subtract(t){throw new Error("Method 'subtract()' must be implemented.")}withinSectorCentredOn(t,e){return t.subtract(e).lessThanOrEqualTo(this)&&this.lessThanOrEqualTo(t.add(e))}toString(){throw new Error("Method 'toString()' must be implemented.")}}class m extends p{#i;static fromRadians(t){if(!t instanceof w&&!h(t))throw new Error("Degrees must be Radians or a number.");const e=t instanceof w?t.piCoefficient:t/Math.PI;return new m(e/2*360)}constructor(t){super(),this.#i=t,this.#i>360&&(this.#i=this.#i%360),this.#i<0&&(this.#i=360-this.#i)}asRadians(){return w.fromDegrees(this)}asDegrees(){return this}value(){return this.#i}flip(){return new m(this.#i+180)}equals(t){return t.asDegrees().value()===this.value()}lessThanOrEqualTo(t){return this.#i<=t.asDegrees().value()}add(t){return new m(this.#i+t.asDegrees().value())}subtract(t){return new m(this.#i-t.asDegrees().value())}toString(){return this.value().toFixed(2)+"deg"}}class w extends p{piCoefficient;static fromDegrees(t){if(!t instanceof m&&!h(t))throw new Error("Degrees must be Degrees or a Number.");const e=t instanceof m?t.value():t;return new w(e/360*2)}static fromValue(t){return new w(t/Math.PI)}constructor(t){super(),this.piCoefficient=t,this.piCoefficient>2&&(this.piCoefficient=this.piCoefficient%2),this.piCoefficient<0&&(this.piCoefficient=2+this.piCoefficient)}asRadians(){return this}asDegrees(){return m.fromRadians(this)}value(){return this.piCoefficient*Math.PI}flip(){return new w(this.piCoefficient+1)}equals(t){return t.asRadians().piCoefficient===this.piCoefficient}lessThanOrEqualTo(t){return this.piCoefficient<=t.asRadians().piCoefficient}add(t){return new w(this.piCoefficient+t.asRadians().piCoefficient)}subtract(t){return new w(this.piCoefficient-t.asRadians().piCoefficient)}toString(){return this.piCoefficient.toFixed(4)+"πrad"}}class f{x=0;y=0;constructor(t,e){this.x=t,this.y=e}add(t,e){return new f(this.x+t,this.y+e)}move(t,e){return new g(new d(t,e),this).end(1)}equalsFuzzy(t,e){return e=h(e)?e:2,this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e||t.x>=this.x-e&&t.x<=this.x+e&&t.y>=this.y-e&&t.y<=this.y+e}equals(t){return this.x===t.x&&this.y===t.y}floor(){return new f(Math.floor(this.x),Math.floor(this.y))}round(){return new f(Math.round(this.x),Math.round(this.y))}angleToPoint(t){return w.fromValue(Math.atan2(t.y-this.y,t.x-this.x))}angleFromPoint(t){return w.fromValue(Math.atan2(this.y-t.y,this.x-t.x))}distanceToPoint(t){return Math.sqrt(c(this.x-t.x)+c(this.y-t.y))}projectsOntoLineAt(t){const e=t.length();if(0==e)return t.startPoint;let i=((this.x-t.startPoint.x)*(t.endPoint.x-t.startPoint.x)+(this.y-t.startPoint.y)*(t.endPoint.y-t.startPoint.y))/c(e);return i=l(0,i,1),new f(t.startPoint.x+i*(t.endPoint.x-t.startPoint.x),t.startPoint.y+i*(t.endPoint.y-t.startPoint.y))}distanceToLine(t){return this.distanceToPoint(this.projectsOntoLineAt(t))}toString(){return"["+this.x.toFixed(3)+","+this.y.toFixed(3)+"]"}}class y extends Map{#s;#n;#r;#a;delete(t){throw new Error("Cannot delete pixels from Pixel Map.")}get(t){if(!t instanceof f)throw new Error("PixelMap key must be Point2D");return super.get(t)}has(t){if(!t instanceof f)throw new Error("PixelMap key must be Point2D");return super.has(t)}set(t,e){if(!t instanceof f)throw new Error("PixelMap key must be Point2D");if(!e instanceof a)throw new Error("PixelMap value must be PixelData");return(void 0===this.#s||t.x<this.#s)&&(this.#s=t.x),(void 0===this.#n||t.y<this.#n)&&(this.#n=t.y),(void 0===this.#r||t.x>this.#r)&&(this.#r=t.x),(void 0===this.#a||t.y>this.#a)&&(this.#a=t.y),super.set(t,e)}writeToCanvas(t){if(void 0===this.#s)return;const e=this.#r-this.#s+1,i=this.#a-this.#n+1,s=t.getContext("2d").getImageData(this.#s,this.#n,e,i);Array.from(this.entries()).forEach((([t,i])=>{const n=4*((t.y-this.#n)*e+(t.x-this.#s));s.data[n]=i.r,s.data[n+1]=i.g,s.data[n+2]=i.b,s.data[n+3]=i.a})),t.getContext("2d").putImageData(s,this.#s,this.#n)}}class v{#o;#h=new y;synchroniseDimensions(){throw new Error("Method 'synchroniseDimensions()' must be implemented.")}getContext(t){throw new Error("Method 'getContext()' must be implemented.")}getVisibleRect(){throw new Error("Method 'getVisibleRect()' must be implemented.")}getMaximumPossibleRect(){throw new Error("Method 'getMaximumPossibleRect()' must be implemented.")}hide(){throw new Error("Method 'hide()' must be implemented.")}show(){throw new Error("Method 'show()' must be implemented.")}applyCanvasStyle(t){t&&t!==this.#o&&(this.#o=t,t.applyToCanvas(this))}registerPixelToWrite(t,e){return this.#h.set(t,e),this}renderPixelsToWrite(){return this.#h&&this.#h.writeToCanvas(this),this.#h=new y,this}render(){throw this.renderPixelsToWrite(),new Error("Method 'render()' must be implemented.")}destroy(){throw new Error("Method 'destroy()' must be implemented.")}}class E{x;y;width;height;constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}topLeft(){return new f(this.x,this.y)}topRight(){return new f(this.x+this.width,this.y)}bottomRight(){return new f(this.x+this.width,this.y+this.height)}bottomLeft(){return new f(this.x,this.y+this.height)}pad(t){return new E(this.x-t,this.y-t,this.width+t,this.height+t)}containsPoint(t){const e=this.topLeft(),i=this.bottomRight();return e.x<=t.x&&e.y<=t.y&&t.x<=i.x&&t.y<=i.y}containsRect(t){const e=this.topLeft(),i=t.topLeft(),s=this.bottomRight(),n=t.bottomRight();return e.x<i.x&&e.y<i.y&&s.x>n.x&&s.y>n.y}isEqualTo(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}}class b{getValue(t){throw new Error("Must implement getValue() method.")}}class T{#l;#c;static createIdentity(){return new T(1,1)}constructor(t,e){this.#l=t,this.#c=void 0===e?t:e}scaleX(t){return t*this.#u(this.#l)}scaleY(t){return t*this.#u(this.#c)}#u(t){return t instanceof b?t.getValue():"function"==typeof t?t():t}}!function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(38);class S extends v{#d;backRect;placer;scaler;frontCanvasElement;#g;frontRect;#p=!1;#m={};constructor(t,e,i,s,n,r){super(),this.placer=n,this.scaler=r||T.createIdentity(),this.#d=this.#w(i,s),this.backRect=new E(0,0,i,s),this.frontCanvasElement=new WeakRef(t),this.#g=new WeakRef(e),this.placer.initialize(e,t),this.synchroniseDimensions()}#w(t,e){if(window.OffscreenCanvas)return new OffscreenCanvas(t,e);{const i=document.createElement("canvas");return i.width=t,i.height=e,i}}synchroniseDimensions(){const t=this.#g.deref(),e=this.frontCanvasElement.deref();if(!t||!e)return;const i=this.placer.place(t,e,this.scaler);this.frontRect&&this.frontRect.isEqualTo(i)||(this.frontRect=i,this.render())}getContext(t){return this.#m[t]||(this.#m[t]=this.#d.getContext(t,{willReadFrequently:!0})),this.#m[t]}getClipRect(){return this.placer.getRectForDimensions(this.backRect,this.frontRect.width,this.frontRect.height,this.scaler)}getVisibleRect(){return this.getClipRect()}getMaximumPossibleRect(){return this.backRect}hide(){return this.#p=!0,this}show(){return this.#p=!1,this}render(){this.renderPixelsToWrite();const t=this.frontCanvasElement.deref();if(!t)return;const e=t.getContext("2d");if(e.clearRect(0,0,this.frontRect.width,this.frontRect.height),this.#p)return;const i=this.getClipRect();e.drawImage(this.#d,i.x,i.y,i.width,i.height,0,0,this.frontRect.width,this.frontRect.height)}destroy(){const t=this.frontCanvasElement.deref();t&&t.remove()}}class D{layers;#f;#y;#v;#E;#b;static get EVENT__DISABLE(){return"disable"}static get EVENT__REBOOT(){return"reboot"}static get EVENT__SKIP(){return"skip"}static get EVENT__RESIZE(){return"resize"}constructor(t,e){this.layers=new r,this.#f=new WeakRef(t),this.#y=new WeakRef(e),this.#v=Math.max(window.screen.width||0,window.innerWidth,e.getBoundingClientRect().width),this.#E=Math.max(window.screen.height||0,window.innerHeight,e.getBoundingClientRect().height),window.addEventListener("rebootAnimations",(()=>this.triggerEvent(D.EVENT__REBOOT,this))),window.addEventListener("skipAnimations",(()=>this.triggerEvent(D.EVENT__SKIP,this))),window.addEventListener("da",(()=>this.triggerEvent(D.EVENT__DISABLE,this))),this.#b=window.innerWidth,window.addEventListener("resize",s(this.#T.bind(this),250)),this.#T()}#T(){this.#b!==window.innerWidth?(this.#b=window.innerWidth,this.triggerEvent(D.EVENT__REBOOT,this)):(this.layers.synchroniseDimensions(),this.triggerEvent(D.EVENT__RESIZE,this))}reboot(){const t=this.layers;this.layers=new r,t.forEach((t=>{t.destroy()}),this),t.forEach(((t,e)=>{this.createLayer(e,t.placer,t.scaler)}),this)}getParentElement(){return this.#f.deref()}createLayer(t,e,i){if(this.layers.has(t))return this.layers.get(t);const s=this.#f.deref(),n=this.#y.deref();if(!s||!n)throw new Error("Unable to create layer, parent Element no longer exists.");const r=new S(this.#S(s,t),n,this.#v,this.#E,e,i);return this.layers.set(t,r),r}#S(t,e){const i=document.createElement("canvas");return i.classList.add("top"),i.classList.add(e),0===this.layers.size?t.prepend(i):this.layers.last().frontCanvasElement.deref().after(i),i}render(){return this.layers.render(),this}}Object.assign(D.prototype,n);class M{#D;#M;#t;#x;#A;static get STATUS__INITIAL(){return"initial"}static get STATUS__STARTED(){return"started"}static get STATUS__WAITING(){return"waiting"}static get STATUS__STOPPED(){return"stopped"}constructor(t){this.#D=t,this.#D.canvasManager.registerListener(D.EVENT__DISABLE,this.#R.bind(this)),this.#D.canvasManager.registerListener(D.EVENT__RESIZE,this.#R.bind(this)),this.#D.canvasManager.registerListener(D.EVENT__REBOOT,this.#R.bind(this)),this.#D.canvasManager.registerListener(D.EVENT__SKIP,this.#C.bind(this))}getStatuses(){return[M.STATUS__INITIAL,M.STATUS__STARTED,M.STATUS__WAITING,M.STATUS__STOPPED]}#R(){this.getStatus()===M.STATUS__WAITING&&this.start()}#C(){this.#A=4}start(){this.setStatus(M.STATUS__STARTED),this.#A=1,this.#M||(this.#t=void 0,this.#x=void 0,this.#M=window.requestAnimationFrame(this.#P.bind(this)))}stop(){this.setStatus(M.STATUS__STOPPED),this.#M&&(window.cancelAnimationFrame(this.#M),this.#M=void 0,this.#A=1,this.#x=void 0,this.#t=void 0)}#P(t){void 0===this.#t&&(this.#t=t),t=this.#t+this.#A*(t-this.#t);let e=!0;if(this.#x!==t){const i=t-this.#t,s=void 0===this.#x?0:t-this.#x;e=this.#D.drawFrame(i,s)}if(this.#x=t,!e)return this.setStatus(M.STATUS__WAITING),void(this.#M=void 0);this.#M=window.requestAnimationFrame(this.#P.bind(this))}}Object.assign(M.prototype,i);class x extends Map{layerId;#L;constructor(t,e){super(e),this.layerId=t,this.#L=new Map}addNib(t){return this.set(t.toString(),t)}set(t,e){return null===e?(super.delete(t),this.#L.set(t,!0),this):(super.set(t,e),this)}hasInNullMap(t){return this.#L.has(t)}hasActive(){return Array.from(this).some((([t,e])=>e&&e.isActive()))}tick(t,e,i){this.forEach((s=>s&&s.tick(t,this,e,i)))}}function A(t,e){const i=new Map;let s=0;return t.forEach((t=>{const n=e(t,s++);i.has(n)?i.get(n).push(t):i.set(n,[t])})),i}const R={includes(t,e){return(this[this.itemsProperty()]||[]).includes(t,e)},indexOf(t,e){return(this[this.itemsProperty()]||[]).indexOf(t,e)},filter(t,e){return(this[this.itemsProperty()]||[]).filter(t,e)},find(t,e){return(this[this.itemsProperty()]||[]).find(t,e)},findIndex(t,e){return(this[this.itemsProperty()]||[]).findIndex(t,e)},forEach(t,e){(this[this.itemsProperty()]||[]).forEach(t,e)},groupBy(t){return A(this[this.itemsProperty()]||[],t)},map(t,e){return(this[this.itemsProperty()]||[]).map(t,e)},push(...t){return this[this.itemsProperty()]||=[],this[this.itemsProperty()].push(...t),this},some(t,e){return(this[this.itemsProperty()]||[]).some(t,e)},splice(t,e,...i){return(this[this.itemsProperty()]||[]).splice(t,e,...i)},unshift(...t){return this[this.itemsProperty()]||=[],this[this.itemsProperty()].unshift(...t),this},deleteItem(t){const e=this.indexOf(t);return-1===e||this.splice(e,1),this},size(){return(this[this.itemsProperty()]||[]).length},getAll(){return this[this.itemsProperty()]||[]}},C={getUniqueTags(){return[...new Set((this[this.itemsProperty()]||[]).reduce(((t,e)=>t.concat(e.getTags())),[]))]},filterByTag(t){return(this[this.itemsProperty()]||[]).filter((e=>e.hasTag(t)))},filterByNotTag(t){return(this[this.itemsProperty()]||[]).filter((e=>!e.hasTag(t)))},filterByNoTags(){return(this[this.itemsProperty()]||[]).filter((t=>0===t.getTags().length))},findWithTag(t){return(this[this.itemsProperty()]||[]).find((e=>e.hasTag(t)))},forEachWithTag(t,e,i){return this.filterByTag(t).forEach(e,i),this},forEachWithoutTag(t,e,i){return this.filterByNotTag(t).forEach(e,i),this},forEachUntagged(t,e){return this.filterByNoTags().forEach(t,e),this},someWithTag(t){return(this[this.itemsProperty()]||[]).some((e=>e.hasTag(t)))},tagAll(t){return this.forEach((e=>e.addTag(t))),this},untagAll(t){return this.forEach((e=>e.untag(t))),this}};class P{layerId;constructor(t,e){this.layerId=t,e&&(this["#items"]=e)}itemsProperty(){return"#items"}filterCanDraw(t){return new P(this.layerId,this.filter((e=>e.canDraw(t))))}pickNoMoreThanNDrawable(t,e){return new P(this.layerId,function(t,e){return t.length<=e?t:t.slice(0,e)}(this.filter((t=>t.canDraw(e))),t))}someCanDraw(t){return this.some((e=>e.canDraw(t)))}}Object.assign(P.prototype,R),Object.assign(P.prototype,C);class L{canvasStyler;getRenderTags(){return[]}setCanvasStyler(t){return this.canvasStyler=t,this}applyCanvasStyle(t){if(this.canvasStyler)return t.applyCanvasStyle(this.canvasStyler),this}draw(t,e,i){throw new Error("Implement draw().")}}class O extends L{rect;clear;constructor(t,e){super(),this.rect=t,this.clear=!!e}draw(t,e,i){this.applyCanvasStyle(i),i.getContext("2d")[this.clear?"clearRect":"strokeRect"](this.rect.x,this.rect.y,this.rect.width,this.rect.height)}}const I={addTag(t){return this["#tags"]||={},this["#tags"][t]=1,this},getTags(){return this["#tags"]||={},Object.keys(this["#tags"])},hasTag(t){return this["#tags"]||={},1===this["#tags"][t]},untag(t){return this["#tags"]||={},delete this["#tags"][t],this}};class N{#O;#I;#N;drawer;#_;#F=!1;#k;constructor(t,e,i,s){this.#O=t,this.#I=e,this.#N=t+e,this.#k=t,this.drawer=i,this.#_=s||(t=>t),this.drawer.getRenderTags().forEach((t=>this.addTag(t)))}static get EVENT__FINISHED(){return"finished"}canDraw(t){return this.isActive()&&this.#k<t}draw(t,e){if(this.isActive()){if(this.#k<t){const i=(this.#k-this.#O)/this.#I,s=(Math.min(t,this.#N)-this.#O)/this.#I;this.drawer.draw(this.#_(i),this.#_(s),e),this.#k=t}this.#k>=this.#N&&!this.#F&&(this.#F=!0,this.triggerEvent(N.EVENT__FINISHED,t,t-this.#N,this))}}isActive(){return this.#k<this.#N}}Object.assign(N.prototype,n),Object.assign(N.prototype,I);class _{drawer;#W=!1;constructor(t){this.drawer=t,this.drawer.getRenderTags().forEach((t=>this.addTag(t)))}static get EVENT__FINISHED(){return"finished"}canDraw(t){return!this.#W}draw(t,e){this.#W||(this.#W=!0,this.drawer.draw(0,1,e),this.triggerEvent(_.EVENT__FINISHED,t,0,this))}isActive(){return!this.#W}}Object.assign(_.prototype,n),Object.assign(_.prototype,I);class F{id;canvasManager;nibMap;drawerList;constructor(t,e,i,s){this.id=t,this.canvasManager=e,this.canvasManager.createLayer(this.id,i,s),this.nibMap=new x(this.id),this.drawerList=new P(this.id)}reboot(){return this.nibMap=new x(this.id),this.drawerList=new P(this.id),this}clear(){return this.drawerList.push(new _(new O(this.getCanvas().backRect,!0)).registerListener(N.EVENT__FINISHED,((t,e,i)=>{this.drawerList.deleteItem(i)}))),this}getCanvas(){return this.canvasManager.layers.get(this.id)}hasActiveAnimation(){return(this.drawerList.size()>0||this.nibMap.hasActive())&&this.drawerList.size()<1e4}}class k extends Map{add(t,e,i,s){const n=new F(t,e,i,s);return this.set(t,n),n}hasActiveAnimation(){let t=!1;return this.forEach((e=>t||=e.hasActiveAnimation())),t}reboot(){return this.forEach((t=>t.reboot())),this}}class W{canvasManager;layers;#B=!1;#V=!1;#H=!1;#z=-1;#U;#q;#G;#j;static get FRAME_TIMEOUT(){return 1/0}static get FRAME_DELAY_TOLERANCE(){return 300}static get DRAWERS_PER_FRAME_LIMIT(){return 2e3}static get DEBUG_ENABLED(){return!1}static get DEBUG_FRAME_FREQUENCY(){return 10}static get RENDER_TAG__PATH(){return"path"}constructor(t){this.canvasManager=t,this.#G=()=>{},this.layers=new k,window.addEventListener("focus",this),window.addEventListener("blur",this),t.registerListener(D.EVENT__REBOOT,this.#Y.bind(this)),t.registerListener(D.EVENT__DISABLE,this.#X.bind(this))}handleEvent(t){"blur"!==t.type&&"focus"!==t.type||(this.#q=void 0)}#Y(){this.#V=!0}#X(){this.#H=!0}setDisableAnimationsCallback(t,e){return this.#G=t,this.#j=e,this}initialize(t){}drawFrame(t){if(W.FRAME_DELAY_TOLERANCE!==1/0&&void 0!==this.#q&&document.hasFocus()&&performance.now()-this.#q>W.FRAME_DELAY_TOLERANCE||this.#H)return this.#G.call(this.#j),!1;if(this.#V&&(this.#V=!1,this.canvasManager.reboot(),this.layers.reboot(),this.#B=!1),!this.#B)return this.#B=!0,this.initialize(t),!0;this.#z=(this.#z+1)%W.DEBUG_FRAME_FREQUENCY,W.DEBUG_ENABLED&&0===this.#z&&console.log("START FRAME: "+t+"ms"),this.#U=W.DRAWERS_PER_FRAME_LIMIT;try{this.layers.forEach((e=>this.#K(e,t)))}catch(t){if("Frame timed out."!==t)return console.error(t),!1}this.canvasManager.render(),W.DEBUG_ENABLED&&0===this.#z&&console.log("FRAME DURATION: "+this.#$(t));const e=this.layers.hasActiveAnimation();return W.DEBUG_ENABLED&&!1===e&&(console.log("COMPLETE"),console.log(this)),this.#q=e?performance.now():void 0,e}#K(t,e){const i=t.getCanvas();W.DEBUG_ENABLED&&0===this.#z&&console.log("  Layer: "+t.id),this.#J(t.nibMap,t.drawerList,i,e),this.#Q(t.drawerList,i,e,t)}#J(t,e,i,s){t.tick(e,i,s)}#Q(t,e,i,s){for(;t.someCanDraw(i)&&this.#U>0;){let n=t.pickNoMoreThanNDrawable(this.#U,i);this.#U-=n.size(),n.getUniqueTags().toSpliced(-1,0,void 0).forEach((r=>this.#Z(r,n,t,e,i,s)))}}#Z(t,e,i,s,n,r){const a=void 0===t?e.filterByNoTags():e.filterByTag(t);t!==W.RENDER_TAG__PATH&&a.forEach((t=>t.draw(n,s)));const o=this;A(a,(t=>t.drawer.canvasStyler)).forEach((t=>{if(s.getContext("2d").beginPath(),t.forEach((t=>t.draw(n,s))),s.getContext("2d").stroke(),W.DEBUG_ENABLED&&0===o.#z&&console.log("    Drew "+t.length+" lines (nibMap.size = "+r.nibMap.size+", drawerList.length = "+r.drawerList.size()),o.#tt(n))throw"Frame timed out."}))}#tt(t){if(W.FRAME_TIMEOUT===1/0)return!1;const e=this.#$(t),i=e>W.FRAME_TIMEOUT;return W.DEBUG_ENABLED&&i&&console.log("FRAME TIMED OUT AFTER "+e+"ms WHICH EXCEEDED "+W.FRAME_TIMEOUT+"ms"),i}#$(t){return performance.now()-t}}class B{canvasStyler;uniquifyingId;constructor(t){this.uniquifyingId=t||""}addToNibMap(t){const e=this.toString();return!t.has(e)&&!t.hasInNullMap(e)&&(t.set(e,this),!0)}setCanvasStyler(t){return this.canvasStyler=t,this}toString(){return"n:"+this.uniquifyingId}pushOneTimeDrawerToDrawerList(t,e,i,s,n,r,a,o){const h=this;t.push(new N(s,r,n.setCanvasStyler(this.canvasStyler),o).registerListener(N.EVENT__FINISHED,(function(e,i,s){t.deleteItem(s),(a||(()=>{})).call(h,e,i,s)})))}isActive(){throw new Error("Method 'isActive()' must be implemented.")}tick(t,e,i,s){throw new Error("Method 'tick()' must be implemented.")}}Object.assign(B.prototype,I),Object.assign(B.prototype,n);class V extends L{vector2D;constructor(t){super(),this.vector2D=t}getRenderTags(){return[W.RENDER_TAG__PATH]}draw(t,e,i){this.applyCanvasStyle(i);const s=i.getContext("2d"),n=this.vector2D.end(t),r=this.vector2D.end(e);s.moveTo(n.x,n.y),s.lineTo(r.x,r.y)}}class H extends B{#et;#it;#st;#nt;#rt;#at;#ot;static createStarOfNibsAroundPoint(t,e,i,s,n,r,a,o,h,l){return a<=0?[]:function(t,e,i){for(var s=[],n=2/(i-1),r=0;r<i;r++)s.push(0+n*r);return s}(0,0,e+1).slice(0,-1).map((t=>new w(t))).map((n=>new H(t,n,e,i,s,a,h,l).setCanvasStyler(o))).filter((t=>t.addToNibMap(r)))}getStatuses(){return["init","waiting","drawing","done"]}constructor(t,e,i,s,n,r,a,o){super(o),this.#et=t,this.#it=e,this.#st=i,this.#nt=s,this.#rt=n,this.#at=r,this.#ot=a}addToNibMap(t){const e=this.toString(),i=this.getInverted().toString(),s=t.has(e)||t.hasInNullMap(e),n=t.has(i)||t.hasInNullMap(i);let r=!1;return s||n||(t.set(e,this),r=!0),n||t.set(i,null),r}toString(){return super.toString()+":l2s:"+this.getVector2D().toString()}getVector2D(){return new g(new d(this.#nt,this.#it),this.#et)}getInverted(){const t=this.getVector2D().getInverted();return new H(t.start(),t.angle(),this.#st,this.#nt,this.#rt,this.#at,this.#ot,this.uniquifyingId)}isActive(){return["init","drawing"].includes(this.getStatus())}tick(t,e,i,s){if(["drawing","done"].includes(this.getStatus()))return;if(!i.getVisibleRect().pad(this.#nt).containsPoint(this.#et))return void(!this.#ot||this.#et.x<0||this.#et.y<0||!i.getMaximumPossibleRect().pad(this.#nt).containsPoint(this.#et)?(this.setStatus("done"),e.set(this.toString(),null)):this.setStatus("waiting"));this.setStatus("drawing");const n=this;t.push(new N(s,this.#rt,new V(this.getVector2D()).setCanvasStyler(this.canvasStyler)).registerListener(N.EVENT__FINISHED,(function(s,r,a){n.setStatus("done"),t.deleteItem(a),e.set(n.toString(),null),H.createStarOfNibsAroundPoint(a.drawer.vector2D.end(),n.#st,n.#nt,n.#rt,t,e,n.#at-1,a.drawer.canvasStyler,n.#ot,n.uniquifyingId).forEach((n=>n.tick(t,e,i,s-r)))})))}}Object.assign(H.prototype,i);class z extends L{draw(t,e,i){}}class U extends B{getStatuses(){return["init","drawing","done"]}makeDrawer(t){throw new Error("Method 'makeDrawer()' must be implemented.")}onFinished(t,e,i,s,n){t.deleteItem(e),i.delete(this.toString())}isActive(){return"done"!==this.getStatus()}tick(t,e,i,s){if("init"!==this.getStatus())return;this.setStatus("drawing");const n=this,r=this.makeDrawer(s);r.drawer.setCanvasStyler(this.canvasStyler),r.registerListener(N.EVENT__FINISHED,(function(i,s,r){n.setStatus("done"),n.onFinished(t,r,e,i,s)})),t.push(r)}}Object.assign(U.prototype,i);class q extends U{#ht;#lt;#ct;constructor(t,e,i){super(),this.#ht=t,this.#lt=e,this.#ct=i}toString(){return super.toString()+":w:"+this.#ht.toFixed(0)}makeDrawer(t){return new N(t,this.#ht,new z)}onFinished(t,e,i,s,n){super.onFinished(t,e,i,s,n),this.#lt.call(this.#ct,s,n)}}class G{setUpCanvasFn;constructor(t){this.setUpCanvasFn=t}applyToCanvas(t){t.getContext("2d").restore(),t.getContext("2d").save(),this.setUpCanvasFn(t)}}class j{angle;id;#ut;#dt;#gt;#pt;constructor(t,e,i,s){this.angle=t,this.id=e,this.#ut=i,this.#dt=s}setFlipped(t){return this.#gt=t,this}flip(){return this.#gt}setBaseChanger(t){return this.#pt=t,this}withSouthAs(t){return this.#pt.call(this,t)}toString(){return this.id}movePoint(t,e){return e=e||1,new f(t.x+this.#ut*e,t.y+this.#dt*e)}}const Y=new j(new m(270),"N",0,-1),X=new j(new m(0),"E",1,0),K=new j(new m(90),"S",0,1),$=new j(new m(180),"W",-1,0);Y.setFlipped(K),K.setFlipped(Y),X.setFlipped($),$.setFlipped(X),Y.setBaseChanger((t=>t.flip())),X.setBaseChanger((t=>{switch(t){case Y:return $;case X:return Y;case K:return X;case $:return K;default:throw new Error("Unsupported Direction")}})),K.setBaseChanger((t=>t)),$.setBaseChanger((t=>{switch(t){case Y:return X;case X:return K;case K:return $;case $:return Y;default:throw new Error("Unsupported Direction")}}));const J=[Y,X,K,$];class Q extends L{drawers;constructor(t){super(),this.drawers=t}getRenderTags(){return 0===this.drawers.length?[]:this.drawers.slice(1).map((t=>t.getRenderTags())).reduce(((t,e)=>JSON.stringify(t)===JSON.stringify(e)?t:[]),this.drawers.slice(0,1).pop().getRenderTags())}setCanvasStyler(t){return this.canvasStyler=t,this.drawers.forEach((e=>{e.setCanvasStyler(t)})),this}applyCanvasStyle(t){return this.drawers.forEach((e=>{e.applyCanvasStyle(t)})),this}draw(t,e,i){this.drawers.forEach((s=>{s.draw(t,e,i)}))}}class Z extends L{vector2D;constructor(t){super(),this.vector2D=t}draw(t,e,i){const s=this.vector2D.end(t).round(),n=this.vector2D.end(e).round();this.#mt(s.x,s.y,n.x,n.y,((t,e)=>i.registerPixelToWrite(new f(t,e),new a(0,0,0,255))))}#mt(t,e,i,s,n){Math.abs(s-e)<Math.abs(i-t)?t>i?this.#wt(i,s,t,e,n):this.#wt(t,e,i,s,n):e>s?this.#ft(i,s,t,e,n):this.#ft(t,e,i,s,n)}#wt(t,e,i,s,n){let r=i-t,a=s-e,o=1;a<0&&(o=-1,a=-a);let h=2*a-r,l=e;for(let e=t;e<=i;e++)n.call(this,e,l),h>0?(l+=o,h+=2*(a-r)):h+=2*a}#ft(t,e,i,s,n){let r=i-t,a=s-e,o=1;r<0&&(o=-1,r=-r);let h=2*r-a,l=t;for(let t=e;t<=s;t++)n.call(this,l,t),h>0?(l+=o,h+=2*(r-a)):h+=2*r}}class tt extends B{#yt;#et;#vt;#Et;#bt;#Tt;#St;#Dt;#Mt;static get WALL_WIDTH(){return 1}getStatuses(){return["init","waiting","drawing","done"]}constructor(t,e,i,s,n,r){super(r),this.#yt=t,this.#et=e,this.#vt=i,this.#Et=s,this.#bt=n,this.#Tt=new f(Math.floor(e.x/this.#Et),Math.floor(e.y/this.#Et)),this.#St=new Map,this.#Dt=new Map,this.#Mt=new E(this.#Tt.x*this.#Et,this.#Tt.y*this.#Et,this.#Et,this.#Et)}toString(){return super.toString()+":maze:"+this.#Et+":"+this.#Tt.toString()}isActive(){return["init","drawing"].includes(this.getStatus())}#xt(t){return!t.getVisibleRect().pad(this.#Et).containsRect(this.#At())}#At(){return this.#Mt}#Rt(t){const e=new Map;J.forEach((i=>{const s=this.#Ct(i).toString();e.set(s,t.get(s))}));const i=new Map;J.forEach((t=>{if(void 0!==this.getWall(t))return void this.#Dt.set(t,!0);const s=e.get(t),n=s?s.getWall(t.flip()):void 0;void 0!==n?(this.setWall(t,s.getWall(t.flip())),this.#Dt.set(t,n)):t===this.#vt?this.setWall(t,!1):i.set(t,!0)}),this),Array.from(this.#yt.calculateGridWalls(this.#Tt,this.#et,i,this.#St,this.#vt).entries()).forEach((([t,i])=>{this.setWall(t,i),e.get(t)&&e.get(t).setWall(t.flip(),i)}))}#Ct(t){return new tt(this.#yt,t.movePoint(this.#et,this.#Et),t.flip(),this.#Et,this.#bt,this.uniquifyingId)}getWall(t){return this.#St.get(t)}setWall(t,e){return this.#St.set(t,e)}#Pt(t){switch(t){case Y:return new Z(new g(new d(this.#Et,X.angle),this.#At().topLeft()));case X:return new Z(new g(new d(this.#Et,K.angle),this.#At().topRight()));case K:return new Z(new g(new d(this.#Et,$.angle),this.#At().bottomRight()));case $:return new Z(new g(new d(this.#Et,Y.angle),this.#At().bottomLeft()))}}tick(t,e,i,s){if(["drawing","done"].includes(this.getStatus()))return;if("init"===this.getStatus()&&(this.#Rt(e),W.DEBUG_ENABLED)){const n=new Z(this.#yt.line.toBoundVector());this.pushOneTimeDrawerToDrawerList(t,e,i,s,n,1),n.setCanvasStyler(new G((t=>{const e=t.getContext("2d");e.strokeStyle="rgba(255, 0, 0, 0.2)",e.lineWidth=1})))}if(this.#xt(i))return void this.setStatus("waiting");this.setStatus("drawing");const n=this;this.pushOneTimeDrawerToDrawerList(t,e,i,s,new Q(Array.from(this.#St.entries()).filter((([t,e])=>e)).filter((([t,e])=>!0!==n.#Dt.get(t))).map((([t,e])=>n.#Pt(t)))),this.#bt,((s,r,a)=>{n.setStatus("done"),Array.from(n.#St.entries()).filter((([t,e])=>!e)).map((([t,e])=>n.#Ct(t).setCanvasStyler(a.drawer.canvasStyler))).filter((t=>t.addToNibMap(e))).forEach((n=>n.tick(t,e,i,s-r)))}))}}Object.assign(tt.prototype,i),new class{#Lt=new Map;constructor(){window.addEventListener("keydown",this.#Ot.bind(this)),window.addEventListener("keyup",this.#It.bind(this))}#Ot(t){this.#Lt.set(t.key,!0)}#It(t){return this.#Lt.set(t.key,!1),this}isKeyPressed(t){return this.#Lt.get(t)||!1}};class et{line;minDistance;maxDistance;#Nt=6e3;#_t=2;constructor(t,e,i){this.line=t,this.minDistance=e,this.maxDistance=i}calculateGridWalls(t,e,i,s,n){const r=e.projectsOntoLineAt(this.line),a=this.line.startPoint.distanceToPoint(r)/this.line.length(),l=e.distanceToPoint(r),c=(u=this.maxDistance)+a*(this.minDistance-u);var u;const d=$.withSouthAs(n),g=Y.withSouthAs(n),p=X.withSouthAs(n),w=function(t,e,i){const s=[];return t.forEach(((t,i,n)=>{const r=e.call(undefined,t,i,n);if(h(r)&&!(r<=0))for(let e=0;e<r;e++)s.push(t)})),s}([[3,1,.3,new Map([[d,!1],[g,!1],[p,!1]])],[2,2,.4,new Map([[d,!1],[g,!0],[p,!1]])],[2,2,.4,new Map([[d,!1],[g,!1],[p,!0]])],[2,2,.4,new Map([[d,!0],[g,!1],[p,!1]])],[1,2,.9999,new Map([[d,!0],[g,!1],[p,!0]])],[1,2,.9999,new Map([[d,!1],[g,!0],[p,!0]])],[1,2,.9999,new Map([[d,!0],[g,!0],[p,!1]])],[0,1,1+Number.EPSILON,new Map([[d,!0],[g,!0],[p,!0]])]].filter((([t,e,i,s])=>a<i),this).filter((([t,e,i,s])=>this.#_t+t-1<=this.#Nt),this).filter((([t,e,i,n])=>{let r=!0;return Array.from(n.entries()).forEach((([t,e])=>{void 0!==s.get(t)&&s.get(t)!==e&&(r=!1)})),r})).map((([t,e,i,s])=>[t,Array.from(s.entries()).reduce(((t,[e,i])=>t||!1===i&&e.angle.withinSectorCentredOn(this.line.angle(),new m(45))),!1)?8*e:e,s])),(([t,e,i,s])=>e)),f=Math.min(Math.abs(l/c),1),y=(E=function(t){return 0!==(e=void 0===(e=f)?.5:e)&&(e>=1||0===Math.floor(Math.random()*(1/e)))?1-Number.EPSILON:Math.min(function(t){return t*t*t*t}(t),1-Number.EPSILON);var e},(v=w)[o(0,v.length-1,E)]);var v,E;return this.#_t=this.#_t-1+y[0],y[2]}}class it{startPoint;endPoint;#it;constructor(t,e){this.startPoint=t,this.endPoint=e}angle(){return void 0===this.#it&&(this.#it=this.startPoint.angleToPoint(this.endPoint)),this.#it}length(){return this.startPoint.distanceToPoint(this.endPoint)}distanceToPoint(t){return t.distanceToLine(this)}toBoundVector(){return g.createFromPoints(this.startPoint,this.endPoint)}}class st extends L{drawers;#Ft;constructor(t){super(),this.drawers=Array.from(t),this.#Ft=1/this.drawers.length}getRenderTags(){return 0===this.drawers.length?[]:this.drawers.slice(1).map((t=>t.getRenderTags())).reduce(((t,e)=>JSON.stringify(t)===JSON.stringify(e)?t:[]),this.drawers.slice(0,1).pop().getRenderTags())}setCanvasStyler(t){return this.canvasStyler=t,this.drawers.forEach((e=>{e.setCanvasStyler(t)})),this}applyCanvasStyle(t){return this.drawers.forEach((e=>{e.applyCanvasStyle(t)})),this}draw(t,e,i){if(t===e)return;const s=l(0,Math.floor(t/this.#Ft),this.drawers.length-1),n=l(0,Math.floor((e-Number.EPSILON)/this.#Ft),this.drawers.length-1);for(let a=s;a<=n;a++)this.drawers[a].draw(s<a?0:t%this.#Ft/this.#Ft,a<n?1:(r=(e-Number.EPSILON)%this.#Ft/this.#Ft,Math.abs(1-r)<1e-15?1:r),i);var r}}class nt extends st{constructor(t,e,i){const s=[];let n;t.getPoints(((t,e)=>{if(void 0!==n){const e=g.createFromPoints(n,t);s.push(new V(e))}n=t}),null,e,i),s.push(new V(g.createFromPoints(t.getPoint(i||t.numberOfSides-1),t.getPoint(e||0)))),super(s)}}class rt{centrePoint;radius;numberOfSides;#kt=[];constructor(t,e,i){this.centrePoint=t,this.radius=e,this.numberOfSides=i}getPoint(t){return t%=this.numberOfSides,void 0!==this.#kt[t]||(this.#kt[t]=new f(this.centrePoint.x+this.radius*Math.cos(t*u/this.numberOfSides),this.centrePoint.y+this.radius*Math.sin(t*u/this.numberOfSides))),this.#kt[t]}getPoints(t,e,i,s){if((i=void 0===i?0:i)>(s=void 0===s?this.numberOfSides-1:s))throw new Error("Start index should be lower than end index.");if(t||this.#kt.length<this.numberOfSides)for(let n=0;n<this.numberOfSides;n++)this.getPoint(n),t&&i<=n&&n<=s&&t.call(e,this.getPoint(n),n);return this.#kt.slice(i,s+1)}toString(){return this.numberOfSides+this.centrePoint.toString()+this.radius}}class at extends B{#Wt;#Bt;#Vt;#Ht;#ot;getStatuses(){return["init","waiting","drawing","done"]}constructor(t,e,i,s,n){super(n),this.#Wt=t,this.#Vt=0,this.#Bt=e,this.#Ht=i,this.#ot=s}toString(){return super.toString()+":poly:"+this.#Wt.toString()}isActive(){return["init","drawing"].includes(this.getStatus())}#xt(t){return this.#zt().containsRect(t.getVisibleRect())}#zt(){const t=new m(45).asRadians().value(),e=Math.cos(t),i=Math.sin(t),s=this.#Wt.radius+this.#Vt,n=new f(2*(this.#Wt.centrePoint.x-e*s),2*(this.#Wt.centrePoint.y-i*s)),r=new f(2*(this.#Wt.centrePoint.x+e*s),2*(this.#Wt.centrePoint.y+i*s));return new E(n.x,n.y,r.x-n.x,r.y-n.y)}tick(t,e,i,s){if(["drawing","done"].includes(this.getStatus()))return;if(this.#xt(i))return void this.setStatus(this.#ot?"waiting":"done");this.setStatus("drawing");const n=this;this.pushOneTimeDrawerToDrawerList(t,e,i,s,new nt(new rt(this.#Wt.centrePoint,this.#Wt.radius+n.#Vt,this.#Wt.numberOfSides)),this.#Bt,((s,r)=>{n.setStatus("init"),n.#Vt+=n.#Ht,n.tick(t,e,i,s-r)}))}}Object.assign(at.prototype,i);class ot{static LEFT="left";static CENTRE="centre";static RIGHT="right";static TOP="top";static MIDDLE="middle";static BOTTOM="bottom";horizontal;vertical;constructor(t,e){this.horizontal=t,this.vertical=e}getLeft(t,e,i){switch(this.horizontal){case ot.LEFT:return 0;case ot.CENTRE:return t/2-i.scaleX(e)/2;case ot.RIGHT:return t-i.scaleX(e);default:throw new Error("Unrecognized horizontal direction")}}getTop(t,e,i){switch(this.vertical){case ot.TOP:return 0;case ot.MIDDLE:return t/2-i.scaleY(e)/2;case ot.BOTTOM:return t-i.scaleY(e);default:throw new Error("Unrecognized vertical direction")}}}class ht{anchor;widthLengthValue;heightLengthValue;#Ut;#qt;constructor(t,e,i,s){this.anchor=t,this.widthLengthValue=e,this.heightLengthValue=i,this.#Ut=s}initialize(t,e){return t.style.position="relative",e.style.position="absolute",[ot.LEFT,ot.RIGHT].includes(this.anchor.horizontal)&&(e.style[this.anchor.horizontal]="0px"),[ot.TOP,ot.BOTTOM].includes(this.anchor.vertical)&&(e.style[this.anchor.vertical]="0px"),this}place(t,e,i){i=i||T.createIdentity();const s=this.getRectWithinParent(t,i);return this.#qt&&this.#qt.isEqualTo(s)||(this.#qt=s,this.anchor.horizontal===ot.CENTRE&&(e.style.left=s.x+"px"),this.anchor.vertical===ot.MIDDLE&&(e.style.top=s.y+"px"),e.width=s.width,e.height=s.height),s}getRectWithinParent(t,e){const i=t===window||t===document||t===document.documentElement?new E(0,0,document.documentElement.clientWidth,this.#Ut?document.body.getBoundingClientRect().height:document.documentElement.clientHeight):t.getBoundingClientRect();return this.getRectForDimensions(i,this.widthLengthValue.getValue(i.width),this.heightLengthValue.getValue(i.height),e)}getRectForDimensions(t,e,i,s){return new E(this.anchor.getLeft(t.width,e,s),this.anchor.getTop(t.height,i,s),s.scaleX(e),s.scaleY(i))}}class lt extends b{#i;constructor(t){super(),this.#i=t}getValue(t){return l(0,t*this.#i,t)}}class ct extends b{#i;#Gt;static HEIGHT="HEIGHT";static WIDTH="WIDTH";static vw(t){return new ct(t,ct.WIDTH).getValue()}static vh(t){return new ct(t,ct.HEIGHT).getValue()}constructor(t,e){super(),this.#i=t,this.#Gt=e}getValue(t){const e=this.#jt();return l(0,e*this.#i,e)}#jt(){switch(this.#Gt){case ct.WIDTH:return document.documentElement.clientWidth;case ct.HEIGHT:return document.documentElement.clientHeight;default:throw new Error("Unrecognized viewportDimension")}}}class ut extends W{#Yt=!1;constructor(t){super(t)}initialize(t){let e,i,s;super.initialize(t),[e,i,s]=this.#Xt();const n=new G((t=>{const e=t.getContext("2d");e.strokeStyle="rgba(0, 0, 0, 0.2)",e.lineWidth=1})),r=new G((t=>{const e=t.getContext("2d");e.lineWidth=10,e.globalCompositeOperation="destination-out"})),a=new G((t=>{const e=t.getContext("2d");e.strokeStyle="rgba(0, 0, 0, 1)",e.lineWidth=1}));let o=0;const h=t=>(o+=(this.#Yt?10:200)*t,o);this.#Yt||document.querySelectorAll(".arrive-with-anim-stage").forEach((t=>t.style.opacity=0)),this.#Kt(0),this.#Yt||(this.#$t(i,h(6),n),this.#Jt(i,h(1),r)),e.nibMap.addNib(new q(2e3,(()=>this.#Kt(1)),this)),this.#Qt(e,h(7)),e.nibMap.addNib(new q(4e3,(()=>this.#Kt(2)),this)),e.nibMap.addNib(new q(6e3,(()=>this.#Kt(3)),this)),e.nibMap.addNib(new q(8e3,(()=>this.#Kt(4)),this)),this.#Zt(s,h(24),h(4),a),this.#te(i,h(8),n),e.nibMap.addNib(new q(12e3,(()=>this.#Kt(5)),this)),this.#Yt=!0}#$t(t,e,i){t.nibMap.addNib(new q(e,(()=>{H.createStarOfNibsAroundPoint(new f(t.getCanvas().getVisibleRect().bottomRight().x-80,0),6,12,7,t.drawerList,t.nibMap,200,i,!1,"grid")})))}#Jt(t,e,i){t.nibMap.addNib(new q(e,(()=>{t.nibMap.addNib(new at(new rt(new f(t.getCanvas().getVisibleRect().bottomRight().x-80,0),10,4),5,9,!1,"grid").setCanvasStyler(i).registerListener("status",(e=>{"waiting"!==e.status&&"done"!==e.status||t.clear()})))})))}#te(t,e,i){const s=ct.vw(1),n=s>1e3?330:.3*s;t.nibMap.addNib(new q(e,(()=>{H.createStarOfNibsAroundPoint(new f(t.getCanvas().getVisibleRect().bottomRight().x-.333*n,0),6,12,60,t.drawerList,t.nibMap,Math.floor(n/12),i,!0,"bg")})))}#Qt(t,e){const i=new ct(.1,ct.WIDTH).getValue(),s=.66666*i,n=new f(i,80);t.nibMap.addNib(new q(e,(()=>{t.nibMap.addNib(new tt(new et(new it(n,n.move(300,K.angle)),30,s),n,Y,6,80))})))}#Zt(t,e,i,s){const n=t.getCanvas().getVisibleRect().bottomRight();let r=[new f(n.x-130,0),new f(n.x-80,0),new f(n.x-115,0)].sort((()=>.5-Math.random()));r[0].y=n.y-80,r[1].y=n.y-180,r[2].y=n.y-260,t.nibMap.addNib(new q(e,(()=>{H.createStarOfNibsAroundPoint(r.shift(),5,15,20,t.drawerList,t.nibMap,3,s,"snow")}))),t.nibMap.addNib(new q(i,(()=>{H.createStarOfNibsAroundPoint(r.shift(),7,12,20,t.drawerList,t.nibMap,3,s,"snow")}))),t.nibMap.addNib(new q(i,(()=>{H.createStarOfNibsAroundPoint(r.shift(),5,8,20,t.drawerList,t.nibMap,3,s,"snow")})))}#Xt(){return[this.layers.add("left",this.canvasManager,new ht(new ot(ot.LEFT,ot.TOP),new lt(.2),new lt(1))),this.layers.add("top-right",this.canvasManager,new ht(new ot(ot.RIGHT,ot.TOP),new lt(1),new lt(1),!0)),this.layers.add("bottom-right",this.canvasManager,new ht(new ot(ot.RIGHT,ot.BOTTOM),new lt(.2),new ct(1,ct.HEIGHT)),new T((()=>1/l(.5,ct.vw(.4)/400,1))))]}#Kt(t){const e=this.canvasManager.getParentElement();e&&(e.classList.add("anim-stage-"+t),document.querySelectorAll(".arrive-with-anim-stage-"+t).forEach((t=>{t.classList.contains("shown")||(t.classList.add("shown"),t.style.opacity=1,t.style.pointerEvents="auto")})),document.querySelectorAll(".leave-with-anim-stage-"+t).forEach((t=>{t.classList.contains("hidden")||(t.classList.add("hidden"),t.style.opacity=0,t.style.pointerEvents="none",setTimeout((()=>{t.style.display="none"}),2e3))})))}}function dt(t,e){window.location.assign([window.location.origin,window.location.pathname,(()=>{const i=new URLSearchParams(window.location.search);return t.call(e,i),(Array.from(i.entries()).length>0?"?":"")+i.toString()})()].join(""))}class gt{#ee;#ie;#se;#ne;#ct;#re;#ae;#oe;#he;static ANIMATION_LAG_MS=800;constructor(t,e,i,s,n){this.#ee=t,this.#ie=e,this.#ae=l(gt.ANIMATION_LAG_MS/1e3,(e-gt.ANIMATION_LAG_MS)/1e3,1/0),this.#se=i,this.#ne=s,this.#ct=n,this.#ee.addEventListener("mouseenter",this.#le.bind(this)),this.#ee.addEventListener("mouseleave",this.#ce.bind(this))}#le(){void 0===this.#re&&this.#se.call(this.#ct,this.#ee)&&(this.#ue(),this.#re=window.setTimeout(this.#de.bind(this),this.#ie))}#de(){this.#ge(),this.#ne.call(this.#ct,this.#ee)}#ce(t){this.clearTimer()}#ue(){return this.#ge(),this.#oe=this.#pe(),this.#ee.style.position="relative",this.#ee.appendChild(this.#oe),window.setTimeout((()=>{this.#oe&&(this.#oe.style.opacity=.5,this.#oe.style.setProperty(this.#he,"100%"))}),gt.ANIMATION_LAG_MS),this}#ge(){if(this.#oe)return this.#oe.remove(),this.#oe=void 0,this}#pe(){this.#he="--progress-"+"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(+t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+t/4).toString(16))),window.CSS.registerProperty({name:this.#he,syntax:"<percentage>",inherits:!1,initialValue:"0%"});const t=document.createElement("span");return t.setAttribute("role","presentation"),t.classList.add("timer"),t.style.cssText=`\n      pointer-events: none;\n      position: absolute;\n      right: 10px;\n      bottom: 10px;\n      width: 10px;\n      height: 10px;\n      clip-path: circle();\n      ${this.#he}: 0;\n      transition:${this.#he} ${this.#ae}s linear;\n      background: conic-gradient(black var(${this.#he}), white var(${this.#he}));\n      opacity: 0;\n    `,t}clearTimer(){void 0!==this.#re&&(this.#ge(),window.clearTimeout(this.#re),this.#re=void 0)}}class pt{group;#me;#we;#fe;#ye;#ve;#Ee=!1;#be=!1;#Te=!1;static GROUPS;static HOVER_TO_CLICK_MS=2500;static attach(){String.prototype.includes.call(window.location.search,"da")||(pt.GROUPS=new Map,document.querySelectorAll("details").forEach((t=>{const e=t.getAttribute("name")||t.getAttribute("data-name");t.removeAttribute("name");const i=new pt(t,e);e&&(pt.GROUPS.has(e)||pt.GROUPS.set(e,[]),pt.GROUPS.set(e,pt.GROUPS.get(e).concat(i)))})))}static detach(){String.prototype.includes.call(window.location.search,"da")||document.querySelectorAll("details").forEach((t=>{t.dispatchEvent(new CustomEvent("detachAccordion",{bubbles:!1,cancelable:!1}))}))}static onGroupOpening(t,e){(pt.GROUPS.get(e)||[]).filter((e=>e!==t)).forEach((t=>t.close()))}constructor(t,e){this.#me=t,this.#we=t.querySelector("summary"),this.#fe=t.querySelector(".content"),this.group=e,this.#ye=null,this.#Ee=!1,this.#be=!1,this.#we.addEventListener("click",this.#Se.bind(this)),Number.isFinite(pt.HOVER_TO_CLICK_MS)&&(this.#ve=new gt(this.#we,pt.HOVER_TO_CLICK_MS,this.#De,this.#de,this)),this.#me.open=this.#me.hasAttribute("data-open"),-1==this.#me.getAttribute("tabIndex")&&this.#me.removeAttribute("tabIndex"),this.#Me(this.#me.open),this.#me.addEventListener("detachAccordion",this.#xe.bind(this))}#Se(t){t.preventDefault(),this.#Te||(this.#Ee||!this.#me.open?this.open():(this.#be||this.#me.open)&&this.shrink())}#De(){return!this.#Te&&(!this.#me.open||this.#Ee)}#de(){this.#Te||(this.#we.focus({preventScroll:!0,focusVisible:!1}),this.open())}#xe(){this.#Te=!0,this.#me.open=!0,this.#me.setAttribute("tabIndex",-1),this.#ye&&this.#ye.cancel(),this.#ve&&this.#ve.clearTimer(),pt.GROUPS.set(this.group,(pt.GROUPS.get(this.group)||[]).filter((t=>t!==this)))}close(){this.#Te||(this.#be||this.#me.open)&&this.shrink()}shrink(){if(this.#Te)return;this.#me.style.overflow="hidden",this.#Ee=!0,this.#me.classList.add("closing"),this.#me.classList.remove("open","closed");const t=`${this.#me.offsetHeight}px`,e=`${this.#we.offsetHeight}px`;this.#ve.clearTimer(),this.#ye&&this.#ye.cancel(),document.body.style.height=document.body.getBoundingClientRect().height+"px",document.body.classList.add("sliding-accordion"),this.#ye=this.#me.animate({height:[t,e]},{duration:400,easing:"ease-out"}),this.#ye.onfinish=()=>this.#Me(!1),this.#ye.oncancel=()=>{this.#Ee=!1,this.#me.classList.remove("closing")}}open(){if(this.#Te)return;if(this.#me.open&&!this.#Ee)return;this.#ve.clearTimer(),this.#me.style.overflow="hidden",this.#me.style.height=`${this.#me.offsetHeight}px`,this.#me.open=!0;const t=this;window.requestAnimationFrame((()=>{t.group&&pt.onGroupOpening(t,t.group),t.expand()}))}expand(){if(this.#Te)return;this.#ve.clearTimer(),this.#be=!0,this.#me.classList.add("expanding"),this.#me.classList.remove("open","closed");const t=`${this.#me.offsetHeight}px`,e=`${this.#we.offsetHeight+this.#fe.offsetHeight}px`;this.#ye&&this.#ye.cancel(),document.body.style.height=document.body.getBoundingClientRect().height+"px",document.body.classList.add("sliding-accordion"),this.#ye=this.#me.animate({height:[t,e]},{duration:400,easing:"ease-out"}),this.#ye.onfinish=()=>this.#Me(!0),this.#ye.oncancel=()=>{this.#be=!1,this.#me.classList.remove("expanding")}}#Me(t){this.#Te||(this.#me.open=t,this.#ye=null,this.#Ee=!1,this.#be=!1,this.#me.classList.remove("closing","expanding"),this.#me.classList.add(t?"open":"closed"),this.#me.style.height=this.#me.style.overflow="",document.body.style.height="",document.body.classList.remove("sliding-accordion"))}}!function(){const t="da";if(String.prototype.includes.call(window.location.search,t))return void(document.referrer.includes(window.location.hostname)||function(t,e,i){const s=[];let n;window.requestAnimationFrame||e.call(i,!1);const r=()=>{void 0!==n&&s.push(performance.now()-n),n=performance.now();const a=s.length<10;if(a)window.requestAnimationFrame(r);else{const n=s.reduce(((t,e)=>t+e))/s.length;e.call(i,n<t)}return a};r()}(W.FRAME_DELAY_TOLERANCE,(e=>{e&&dt((e=>{e.delete(t)}))})));const e=()=>{dt((e=>{e.set(t,1)}))},i=[t=>new ut(t)];window.addEventListener("load",(function(){var t;new M((t=i,t[o(0,t.length-1,undefined)])(new D(document.body,document.documentElement)).setDisableAnimationsCallback(e)).start()}))}();const mt=()=>{document.documentElement.clientWidth>=800?pt.detach():pt.attach()};window.addEventListener("load",(function(){window.addEventListener("resize",s(mt,250)),mt()}))})();